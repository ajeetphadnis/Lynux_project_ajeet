<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script type="text/javascript">
		function loadDoc(e) {
			alert("readSingleFile001:  " + e);
			//e.preventDefault();
		  var file = e.target.files[0];
		  if (!file) {
		    return;
		  }
		  var reader = new FileReader();
		  reader.onload = function(e) {
		    var file = e.target.result;
			formData.append('uploaded_files', file, file.name);
		    document.getElementById('envtxt').value = file.Content;
		  };
		  reader.readAsText(file);
		  document.getElementById('upload_file').addEventListener('change', loadDoc, false);
		  //e.preventDefault();
        $.ajax({
            url: "/",
            type: "POST",
            data: formData,
            success: function(response, status, http){
                if (response) {
                	alert('AJAX worked!');
            	}
				document.getElementById("envtxt").value = data.user.Content;
            },
			error: function(jqXHR, textStatus, err){
               alert('text status '+textStatus+', err '+err)
           }
        });
	}
	</script>
</head>
<body>
	<form id="secenv" action="/" method="POST" enctype="multipart/form-data">
		<div class="w3-container">
			<input type="text" id="uid" name="uid" required value="" placeholder="CustomerId" >
			<input type="text" id="target" name="target" required value=""  placeholder="TargetId" >
			<input type="text" id="filetype" name="filetype" required placeholder="FileType">			            
            <input type="file" id="upload_file" name="upload_file" required placeholder="upload_file">						
			Secure Envelope		: <textarea class="textinput" id="envtxt" name="envtxt" ></textarea>
		</div>
		<div class="w3-container">
			<p>Run Create SecureEnvelop scenario</p>
			<button id="but9" class="w3-button w3-black" onclick="loadDoc(event);">SecureEnvelop</button>
	    	</div>
	</form>
	<div class="progress"></div>
</body>
<script type="text/javascript">
	function uploadFilesUpdate(event) {
		alert("uploadFilesUpdate:001:  ");
		var formData = new FormData();
		$(document).ready(function() {
			user = {
				uid: '',
				pass: '',
				serv: '',
				srctxt: '',
				destxt: '',
				jwksets: '',
				oprf: '',
				oprt: '',
				Timestamp: '',
				target: '',
				filetype: '',
				Content: '',
				secenv: '',
				keyInfo: '',
				newuser: {}
			};
			readSingleFile(event, this.formData);
			alert("uploadFilesUpdate:002:  from readSingleFile:  " )
			      $.ajax({
			        //url: '/upload',
			        type: 'POST',
			        data: formData,
			        success: function(response) {
						var usr = JSON.parse(JSON.stringify(response));							          
						JSON.parse(usr, (key, value) => {
							if (typeof value === 'string') {
								alert("Response: key:  " + key + "  value:  " + value);
								if(key === 'uid') user.uid = value;
								if(key === 'ope') user.oprf = value;
								if(key === 'pass') user.pass = value;
								if(key === 'Content') {
									user.secenv = value;
									alert("Response: secenv:   " + user.secenv);
								}
							}
						});
					    document.getElementById("envtxt").value = user.Content;
			        },
			        error: function(error) {
			          alert('Upload Failed. Error: ' + error);
			        },      
			    })
			});
		}

	
	
	function readSingleFile(e) {
		alert("readSingleFile001:  " + e);
		  var file = e.target.files[0];
		  if (!file) {
		    return;
		  }
		  var reader = new FileReader();
		  reader.onload = function(e) {
		    var file = e.target.result;
			formData.append('uploaded_files', file, file.name);
		    displayContents(contents);
		  };
		  reader.readAsText(file);
		  return;
		  //document.getElementById('upload_file').addEventListener('change', readSingleFile, false);
		}

		function displayContents(contents) {
		  var element = document.getElementById('upload_file');
		  element.textContent = contents;
		}	


		function loadDoc11(e) {
			alert("readSingleFile001:  " + e);
			//e.preventDefault();
		  var file = e.target.files[0];
		  if (!file) {
		    return;
		  }
		  var reader = new FileReader();
		  reader.onload = function(e) {
		    var file = e.target.result;
			formData.append('uploaded_files', file, file.name);
		    //displayContents(contents);
		  };
		  reader.readAsText(file);
		  //e.preventDefault();
        $.ajax({
            url: "/",
            type: "POST",
            data: formData,
            success: function(response, status, http){
                if (response) {
                	alert('AJAX worked!');
            }
				//document.getElementById("envtxt").value = data.user.Content;
            },
			error: function(jqXHR, textStatus, err){
               alert('text status '+textStatus+', err '+err)
           }
        });
	}
</script>
</html>